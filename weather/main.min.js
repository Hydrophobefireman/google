(()=>{function slidein(el){el.style.overflow="hidden",el.style.width="0px",el.style.border="0px",el.style.padding="0px",el.style.height="0px",el.style.opacity="0"}function slideout(el){el.style.padding="5px",el.style.opacity=1,el.style.height="auto",el.style.width="auto",el.style.border="2px solid #e3e3e3",el.style.overflow="visible"}function slideOutContext(el,to_slide,finaltext){slideout(to_slide),el.style.textAlign="left",el.textContent=finaltext}function slideInContext(el,to_slide,finaltext){slidein(to_slide),el.style.textAlign="center",el.textContent=finaltext}const $={create:(e,attrs)=>{const el=document.createElement(e);if("object"==typeof attrs){const keys=Object.keys(attrs);for(const i of keys)el.setAttribute(i,attrs[i])}return el}},mainbox=document.getElementById("main"),results=document.getElementById("results");mainbox.innerHTML=results.innerHTML="";const __urltemplate__="https://api.openweathermap.org/data/2.5/weather?APPID=af9fa691905dc9c87bb47d7653de70b5&";function parseTemperature(K){let C=parseInt(K-273.15);C=0===C?0:C;let F=parseInt(9*(K-273.15)/5+32);return{C:C,F:F=0===F?0:F}}function parseSpeed(S){let kmph=parseInt(3.6*S);kmph=0===kmph?0:kmph;let mph=parseInt(2.237*S);return{kmph:kmph,mph:mph=0===mph?0:mph}}function new_parent(child0,child1,type="div"){const div=$.create(type);return div.style.display="flex",div.appendChild(child0),div.appendChild(child1),div}function urlencode(json){return`${Object.keys(json).map(key=>`${encodeURIComponent(key)}=${encodeURIComponent(json[key])}`).join("&")}`}async function createResults(q){mainbox.innerHTML="Loading",window.location.hash=`data=${btoa(q)}`;const urlfetch=__urltemplate__+q;console.log(urlfetch);const resp=await fetch(urlfetch),ret=await resp.json();return parseData(ret)}function parseData(data){mainbox.innerHTML="",results.innerHTML="";const button_new=$.create("div",{class:"confirm-btn"});if(button_new.textContent="Try for another Location",button_new.onclick=(()=>{createUiForManualEntering()}),429===data.cod)return results.textContent="We have been rate-limited..Please try again after some time";if(200!==data.cod)return results.textContent="An Error Occured please check your input.Reload the page and try again";const _info=$.create("div",{class:"results-info"}),timeOfCalc=new Date(1e3*data.dt),tDiv=$.create("div",{class:"W-Time"});tDiv.textContent=`Weather Calculated at: ${timeOfCalc} all times are based on your local time`,results.appendChild(tDiv);const sys=data.sys,countryCode=sys.country,sunrise=new Date(1e3*sys.sunrise).toLocaleTimeString(),sunset=new Date(1e3*sys.sunset).toLocaleTimeString(),city=data.name,locbtn=$.create("div",{class:"open-data","data-state":"closed"}),locdiv=$.create("div",{class:"info-box"}),country_inf=$.create("div",{class:"info-q"}),country_ans=$.create("div",{class:"info-a"}),sunrise_inf=$.create("div",{class:"info-q"}),sunrise_ans=$.create("div",{class:"info-a"}),sunset_inf=$.create("div",{class:"info-q"}),sunset_ans=$.create("div",{class:"info-a"}),city_inf=$.create("div",{class:"info-q"}),city_ans=$.create("div",{class:"info-a"});locbtn.textContent="Click For Locational Info",country_inf.textContent="Country Code",country_ans.textContent=countryCode,city_inf.textContent="City",city_ans.textContent=city,sunrise_inf.textContent="Sunrise Time",sunrise_ans.textContent=sunrise,sunset_inf.textContent="Sunset Time",sunset_ans.textContent=sunset;const _sdiv=new_parent(country_inf,country_ans),_sdiv1=new_parent(city_inf,city_ans),_sdiv2=new_parent(sunrise_inf,sunrise_ans),_sdiv3=new_parent(sunset_inf,sunset_ans);locdiv.appendChild(_sdiv),locdiv.appendChild(_sdiv1),locdiv.appendChild(_sdiv2),locdiv.appendChild(_sdiv3),locbtn.onclick=function(){"closed"===this.getAttribute("data-state")?(slideOutContext(this,locdiv,"Location Info"),this.setAttribute("data-state","opened")):(slideInContext(this,locdiv,"Click For Locational Information"),this.setAttribute("data-state","closed"))},results.appendChild(locbtn),results.appendChild(locdiv);const coords=data.coord,lon=coords.lon,lat=coords.lat,coordsbtn=$.create("div",{class:"open-data","data-state":"closed"}),coordsdiv=$.create("div",{class:"info-box"}),lon_info=$.create("div",{class:"info-q"}),lon_ans=$.create("div",{class:"info-a"}),lat_info=$.create("div",{class:"info-q"}),lat_ans=$.create("div",{class:"info-a"});coordsbtn.textContent="Click For Coordinate Information",lon_info.textContent="Longitude",lon_ans.textContent=`${lon}°`,lat_info.textContent="Latitude",lat_ans.textContent=`${lat}°`;const _div=new_parent(lon_info,lon_ans);coordsdiv.appendChild(_div);const _div1=new_parent(lat_info,lat_ans);coordsdiv.appendChild(_div1),results.appendChild(coordsbtn),results.appendChild(coordsdiv),coordsbtn.onclick=function(){"closed"===this.getAttribute("data-state")?(slideOutContext(this,coordsdiv,"Coordinates"),this.setAttribute("data-state","opened")):(slideInContext(this,coordsdiv,"Click For Coordinate Information"),this.setAttribute("data-state","closed"))};const weather=data.weather[0],weatherTitle=weather.main,weatherDescription=weather.description,weatherbtn=$.create("div",{class:"open-data","data-state":"closed"}),weatherdiv=$.create("div",{class:"info-box"}),wtitle_inf=$.create("div",{class:"info-q"}),wtitle_ans=$.create("div",{class:"info-a"}),wdesc_inf=$.create("div",{class:"info-q"}),wdesc_ans=$.create("div",{class:"info-a"});weatherbtn.textContent="Click For Weather Details",wtitle_inf.textContent="Weather Type",wtitle_ans.textContent=weatherTitle,wdesc_inf.textContent="Description",wdesc_ans.textContent=weatherDescription;const wt_parent=new_parent(wtitle_inf,wtitle_ans),wdesc_parent=new_parent(wdesc_inf,wdesc_ans);weatherdiv.appendChild(wt_parent),weatherdiv.appendChild(wdesc_parent),results.appendChild(weatherbtn),results.appendChild(weatherdiv),weatherbtn.onclick=function(){"closed"===this.getAttribute("data-state")?(slideOutContext(this,weatherdiv,"Weather Details"),this.setAttribute("data-state","opened")):(slideInContext(this,weatherdiv,"Click For Weather"),this.setAttribute("data-state","closed"))};const main=data.main,temp=parseTemperature(main.temp),pressure=main.pressure,humidity=`${main.humidity}%`,temp_max=parseTemperature(main.temp_max),temp_min=parseTemperature(main.temp_min),mainbtn=$.create("div",{class:"open-data","data-state":"closed"}),maindiv=$.create("div",{class:"info-box"}),temp_inf=$.create("div",{class:"info-q"}),temp_ans=$.create("div",{class:"info-a"}),temp_parent=new_parent(temp_inf,temp_ans),pressure_inf=$.create("div",{class:"info-q"}),pressure_ans=$.create("div",{class:"info-a"}),pressure_parent=new_parent(pressure_inf,pressure_ans),humidity_inf=$.create("div",{class:"info-q"}),humidity_ans=$.create("div",{class:"info-a"}),humidity_parent=new_parent(humidity_inf,humidity_ans),tempmax_inf=$.create("div",{class:"info-q"}),tempmax_ans=$.create("div",{class:"info-a"}),tempmax_parent=new_parent(tempmax_inf,tempmax_ans),tempmin_inf=$.create("div",{class:"info-q"}),tempmin_ans=$.create("div",{class:"info-a"}),tempmin_parent=new_parent(tempmin_inf,tempmin_ans);mainbtn.textContent="Click For General Details",temp_inf.textContent="Temperature",temp_ans.textContent=`${temp.C}°C (${temp.F}°F )`,pressure_inf.textContent="Pressure",pressure_ans.textContent=pressure,humidity_inf.textContent="Humidity",humidity_ans.textContent=humidity,tempmax_inf.textContent="Max Temp",tempmax_ans.textContent=`${temp_max.C}°C (${temp_max.F}°F )`,tempmin_inf.textContent="Min Temp",tempmin_ans.textContent=`${temp_min.C}°C (${temp_min.F}°F )`,maindiv.appendChild(temp_parent),maindiv.appendChild(pressure_parent),maindiv.appendChild(humidity_parent),maindiv.appendChild(tempmax_parent),maindiv.appendChild(tempmin_parent),results.append(mainbtn),results.appendChild(maindiv),mainbtn.onclick=function(){"closed"===this.getAttribute("data-state")?(slideOutContext(this,maindiv,"General Details"),this.setAttribute("data-state","opened")):(slideInContext(this,maindiv,"Click For General Details"),this.setAttribute("data-state","closed"))};const clouds=data.clouds,wind=data.wind,clouds_percentage=`${clouds.all}%`,wSpeed=parseSpeed(wind.speed),wDir=wind.deg,miscbtn=$.create("div",{class:"open-data","data-state":"closed"}),miscdiv=$.create("div",{class:"info-box"}),windspd_inf=$.create("div",{class:"info-q"}),windspd_ans=$.create("div",{class:"info-a"}),winddir_inf=$.create("div",{class:"info-q"}),winddir_ans=$.create("div",{class:"info-a"}),cloud_inf=$.create("div",{class:"info-q"}),cloud_ans=$.create("div",{class:"info-a"});miscbtn.textContent="Click For Misc Details",windspd_inf.textContent="Wind Speed",windspd_ans.textContent=`${wSpeed.kmph} Km/h (${wSpeed.mph}mp/h)`,winddir_inf.textContent="Wind Direction",winddir_ans.textContent=wDir,cloud_inf.textContent="Clouds",cloud_ans.textContent=clouds_percentage;const windspd_parent=new_parent(windspd_inf,windspd_ans),winddir_parent=new_parent(winddir_inf,winddir_ans),cloud_parent=new_parent(cloud_inf,cloud_ans);miscdiv.appendChild(windspd_parent),miscdiv.appendChild(winddir_parent),miscdiv.appendChild(cloud_parent),results.appendChild(miscbtn),results.appendChild(miscdiv),miscbtn.onclick=function(){"closed"===this.getAttribute("data-state")?(slideOutContext(this,miscdiv,"Misc Details"),this.setAttribute("data-state","opened")):(slideInContext(this,miscdiv,"Click For Misc Details"),this.setAttribute("data-state","closed"))},_info.textContent="Note:The API can return inaccurate results if the data provided has errors",results.appendChild(_info),results.appendChild(button_new);const sharebtn=$.create("div",{class:"confirm-btn"});sharebtn.textContent="Share This Location",sharebtn.setAttribute("data-new",location.hash.substr(1)),sharebtn.onclick=function(){share(this,window.location.href)},results.appendChild(sharebtn)}function share(x,n){const inp=document.getElementById("copyhelp");console.log(n),inp.value=n,inp.focus(),inp.select();const a=document.execCommand("cut");x.innerHTML=a?"Copied!":"An Error Occured"}function successCallback(val){console.log(val);const data=val.coords,lat=data.latitude,lon=data.longitude,_=urlencode({lat:lat,lon:lon});createResults(_)}function parseqs(query){const params={};query="?"==query[0]?query.substring(1):query;const vars=(query=decodeURI(query)).split("&");for(let i=0;i<vars.length;i++){const pair=vars[i].split("=");params[pair[0]]=decodeURIComponent(pair[1])}return params}function errorCallback(e){console.warn(e),createUiForManualEntering(!0)}const loc_hash=location.hash.substr(1);if(loc_hash){const q=parseqs(loc_hash).data,r=atob(q);console.log(r),createResults(r)}function createUiForPermission(){const div=$.create("div"),pars=$.create("div",{class:"permission-box"}),confirm=$.create("button",{class:"confirm-btn"});div.textContent="Hey There! Please give us the required permissions to access the weather data",confirm.textContent="Give Permission",pars.appendChild(div),pars.appendChild(confirm),mainbox.innerHTML="",mainbox.appendChild(pars),confirm.onclick=(()=>{pars.remove(),navigator.geolocation.getCurrentPosition(successCallback,errorCallback)})}function createUiForManualEntering(error){const div=$.create("div",{class:"permission-box"}),inpCity=$.create("input",{class:"input-box"}),inpCountry=$.create("input",{class:"input-box"}),buttonConf=$.create("button",{class:"confirm-btn"}),info=$.create("div");mainbox.innerHTML="",inpCity.placeholder="Your City",inpCountry.placeholder="Your Country Code",buttonConf.textContent="Confirm";const errdata=error?"An Error Occured. ":"";info.textContent=`${errdata}Please enter your location to access weather data (Format:'city,country code')`,div.appendChild(info),div.appendChild(inpCity),div.appendChild(inpCountry),div.appendChild(buttonConf),mainbox.appendChild(div),inpCity.onkeydown=(e=>{13===e.keyCode&&inpCountry.focus()}),inpCountry.onkeydown=(e=>{13===e.keyCode&&buttonConf.click()}),buttonConf.onclick=(()=>{const city=inpCity.value,country=inpCountry.value;if(0===city.length||0===country.length)return info.textContent="Invalid Data";const q=urlencode({q:`${city},${country}`});createResults(q)})}"geolocation"in navigator?createUiForPermission():createUiForManualEntering()})();